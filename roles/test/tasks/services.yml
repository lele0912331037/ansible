---
# --- 检测服务 ---
- name: 获取monit配置
  stat: path=/etc/monit.d/{{ app_name }}.conf
  register: monit_conf

- name: 服务启停
  when: app_type is defined and monit_conf.stat.isreg == false
  shell: "su - {{ app_user }} -c 'cd {{ scripts_path }} && sh {{ scripts_service }} {{ app_type }}'"
  register: result
  tags: scripts
- debug: var=result.stdout
  notify: update monit

- name: 服务启停，停止
  when: scripts_stop is defined
  shell: "su - {{ app_user }} -c 'cd {{ scripts_path }} && sh {{ scripts_stop }}'"

- name: 服务启停，启动
  when: scripts_start is defined
  shell: "su - {{ app_user }} -c 'cd {{ scripts_path }} && sh {{ scripts_start }}'"

- name: 检查启停脚本结果
  debug: var=result.stdout
